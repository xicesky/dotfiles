#!/bin/bash
declare target="$1"; shift

if [[ "$MSYSTEM" = M* ]] ; then
    # On MinGW / MSYS, convert paths
    if echo "$target" | grep -qP '^\w+:' ; then
        # Target is a URL
        true
    else
        target="$(cygpath -w "$target")"
    fi
    #echo start "$target"
    start "$target"
elif grep -qi microsoft /proc/version ; then
    # On WSL2
    if echo "$target" | grep -qP '^\w+://' ; then
        # Target is a URL
        explorer.exe "$target"
    elif [[ "$#" -eq 0 ]] ; then
        # This works for directories and documents, not for programs with arguments
        explorer.exe "$(wslpath -w "$target")"
    else
        # Fallback to job mgmt - FIXME
        nohup "$target" "$@" &
    fi
else
    # FIXME: Detect OSX
    xdg-open "$target"
fi
